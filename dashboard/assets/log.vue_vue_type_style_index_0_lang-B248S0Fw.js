import{e as ue,a as pe,a7 as me,aq as fe,z as ge,A as be,m as u,Y as E,h as B,o as p,l as a,s as o,O as n,Z as g,X as ye,N as b,k as m,U as s,V as y,j as he,a6 as we,T as _e,H as q,n as Ce,at as ve}from"./vue-5rLikWvG.js";import{e as Ve,x as ke,a5 as De,a7 as xe,a6 as Se}from"./index-CE4S5SW2.js";import{s as L,e as K,k as Te,l as Ue,b as H,u as M,m as Ae}from"./index-DSfSiLib.js";import{F}from"./index-BqsO7Sfb.js";import{b as Be,T as Le,a as Fe}from"./index-B3Ea6OYo.js";import{B as Ne}from"./baAccount-DGNQmTB4.js";import{u as Ie}from"./index-BwzKvMzm.js";const ze={class:"table-header-operate-text"},Pe={class:"table-header-operate-text"},Re={class:"table-header-operate-text"},$e={class:"table-header-operate-text"},Ee={class:"table-header-operate-text"},qe={style:"width: calc(100% - 90px)"},Ke={class:"ba-operate-form"},He={style:"width: calc(100% - 90px)"},Me={class:"download-table-header"},Oe={class:"download-table-header-operate-text"},je={class:"download-table-search"},Qe={class:"log-pagination"},oo=ue({__name:"log",props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(O,{emit:j}){const _=Ve(),Q=Ie(),Y=O,k=j,t=pe({ready:!1,configForm:{syncType:_.crud.syncType,syncedUpdate:_.crud.syncedUpdate,syncAutoPublic:_.crud.syncAutoPublic},showUpload:!1,showConfig:!1,showDownload:!1,showBaAccount:!1,uploadScoreSum:0,uploadValidData:[],uploadValidLoading:!1,downloadPage:1,downloadData:[],downloadTotal:0,downloadLoading:!1,downloadSelection:[],downloadQuickSearch:""}),{t:e}=ke.useI18n(),N=me("tableRef"),G=[{render:"confirmButton",name:"copy",title:"crud.crud.copy",text:"",type:"primary",icon:"fa fa-copy",class:"table-row-copy",popconfirm:{confirmButtonText:e("Confirm"),cancelButtonText:e("Cancel"),confirmButtonType:"primary",title:e("crud.crud.Start CRUD design with this record?"),width:"220px"},disabledTip:!1,click:d=>{L.startData.logId=d[f.table.pk],K("log"),k("update:modelValue",!1)}},{render:"confirmButton",name:"del",title:"crud.log.delete",text:"",type:"danger",icon:"fa fa-trash",class:"table-row-delete",popconfirm:{confirmButtonText:e("crud.crud.Delete Code"),cancelButtonText:e("Cancel"),confirmButtonType:"danger",title:e("crud.crud.Are you sure to delete the generated CRUD code?"),width:"248px"},disabledTip:!1,click:d=>{Te(d[f.table.pk]).then(()=>{f.onTableHeaderAction("refresh",{})})},display:d=>d.status!="delete"&&De("delete")}],f=new Be(new xe("/admin/crud.Log/"),{pk:"id",column:[{type:"selection",align:"center",operator:!1},{label:e("crud.log.id"),prop:"id",align:"center",width:70,operator:"=",sortable:"custom"},{label:e("crud.log.table_name"),operator:"LIKE",render:"slot",slotName:"tableName"},{label:e("crud.log.comment"),prop:"comment",align:"center",showOverflowTooltip:!0,operator:"LIKE"},{label:e("crud.log.sync"),prop:"sync",align:"center",render:"slot",slotName:"sync"},{label:e("crud.log.status"),prop:"status",align:"center",render:"tag",sortable:!1,replaceValue:{delete:e("crud.log.status delete"),success:e("crud.log.status success"),error:e("crud.log.status error"),start:e("crud.log.status start")},custom:{delete:"danger",success:"success",error:"warning",start:""}},{label:e("crud.log.create_time"),prop:"create_time",align:"center",render:"datetime",operator:"RANGE",sortable:"custom",width:160,timeFormat:"yyyy-mm-dd hh:MM:ss"},{label:e("Operate"),align:"center",width:100,render:"buttons",buttons:G,operator:!1}],dblClickNotEditColumn:[void 0]},{defaultItems:{status:"start"}});ve("baTable",f);const W=()=>{var d;(d=f.getData())==null||d.then(()=>{t.ready=!0})},D=d=>{t.showConfig=d},x=d=>{t.showBaAccount=d},S=d=>{t.showUpload=d},X=d=>{t.showDownload=d},Z=d=>{L.startData.logId=d,L.startData.logType="Cloud history",K("log"),k("update:modelValue",!1)},J=()=>{let d=[];for(const r in t.downloadSelection)d.push(t.downloadSelection[r].id);I(d)},I=d=>{Ue({ids:d}).then(r=>{H({syncIds:r.data.syncs,cancelSync:1}).finally(()=>{v(),f.onTableHeaderAction("refresh",{})})})},z=()=>{D(!1),_.setCrud("syncType",t.configForm.syncType),_.setCrud("syncedUpdate",t.configForm.syncedUpdate),_.setCrud("syncAutoPublic",t.configForm.syncAutoPublic),q({type:"success",message:e("axios.Operation successful")})},ee=()=>{S(!0),t.uploadValidLoading=!0,M({logs:f.table.selection,save:0}).then(d=>{t.uploadScoreSum=d.data.scoreSum,t.uploadValidData=d.data.validData}).finally(()=>{t.uploadValidLoading=!1})},oe=()=>{t.uploadValidLoading=!0;const d=f.table.selection;for(const r in d){const h=d[r],c=Se(t.uploadValidData,"sync",h.id.toString());c!==!1&&(h.public=t.uploadValidData[c].public?1:0)}M({logs:d,save:1}).then(r=>{H({syncIds:r.data.syncIds}).finally(()=>{f.onTableHeaderAction("refresh",{}),S(!1),q({type:"success",message:r.msg}),t.uploadValidLoading=!1})})},te=()=>{x(!1)},ae=d=>{t.downloadPage=d,v()},le=d=>{t.downloadSelection=d},ne=fe(()=>v(),500),v=()=>{X(!0),t.downloadLoading=!0,Ae({page:t.downloadPage,quickSearch:t.downloadQuickSearch}).then(d=>{t.downloadData=d.data.list,t.downloadTotal=d.data.total}).finally(()=>{t.downloadLoading=!1})};return ge(()=>{f.table.ref=N.value,f.mount()}),be(()=>Y.modelValue,d=>{d&&!t.ready&&Ce(()=>{W()})}),(d,r)=>{const h=u("Icon"),c=u("el-button"),P=u("el-tooltip"),i=u("el-table-column"),R=u("el-tag"),V=u("el-dialog"),de=u("el-form"),T=u("el-text"),re=u("el-switch"),U=u("el-table"),A=u("el-popconfirm"),se=u("el-input"),ce=u("el-popover"),ie=u("el-pagination"),w=E("blur"),$=E("loading");return p(),B("div",null,[a(V,{onClose:r[3]||(r[3]=l=>k("update:modelValue",!1)),width:"70%","model-value":d.modelValue,class:"ba-crud-log-dialog",title:o(e)("crud.crud.CRUD record"),"append-to-body":!0,"destroy-on-close":!0},{default:n(()=>[a(Le,{buttons:["refresh","quickSearch","columnDisplay"],"quick-search-placeholder":o(e)("crud.log.quick Search Fields")},{default:n(()=>[o(Q).token?(p(),B(ye,{key:0},[a(P,{content:o(e)("crud.log.Upload the selected design records to the cloud for cross-device use"),placement:"top"},{default:n(()=>[g((p(),b(c,{disabled:!(o(f).table.selection.length>0),onClick:ee,class:"table-header-operate",type:"success"},{default:n(()=>[a(h,{color:"#ffffff",name:"fa fa-cloud-upload"}),m("span",ze,s(o(e)("Upload")),1)]),_:1},8,["disabled"])),[[w]])]),_:1},8,["content"]),a(P,{content:o(e)("crud.log.Design records that have been synchronized to the cloud"),placement:"top"},{default:n(()=>[g((p(),b(c,{class:"table-header-operate",onClick:v,type:"success"},{default:n(()=>[a(h,{color:"#ffffff",name:"fa fa-cloud-download"}),m("span",Pe,s(o(e)("crud.log.Cloud record")),1)]),_:1})),[[w]])]),_:1},8,["content"]),g((p(),b(c,{onClick:r[0]||(r[0]=l=>D(!0)),class:"table-header-operate",type:"primary"},{default:n(()=>[a(h,{name:"fa fa-gear"}),m("span",Re,s(o(e)("crud.log.Settings")),1)]),_:1})),[[w]]),g((p(),b(c,{onClick:r[1]||(r[1]=l=>x(!0)),class:"table-header-operate",type:"primary"},{default:n(()=>[a(h,{name:"fa fa-user-o"}),m("span",$e,s(o(e)("layouts.Member information")),1)]),_:1})),[[w]])],64)):g((p(),b(c,{key:1,onClick:r[2]||(r[2]=l=>x(!0)),class:"table-header-operate",type:"primary"},{default:n(()=>[a(h,{name:"fa fa-chain"}),m("span",Ee,s(o(e)("crud.log.Login for backup design")),1)]),_:1})),[[w]])]),_:1},8,["quick-search-placeholder"]),a(Fe,{ref_key:"tableRef",ref:N},{tableName:n(()=>[a(i,{"show-overflow-tooltip":!0,prop:"table_name",align:"center",label:o(e)("crud.log.table_name")},{default:n(l=>[y(s((l.row.table.databaseConnection?l.row.table.databaseConnection+".":"")+l.row.table.name),1)]),_:1},8,["label"])]),sync:n(()=>[a(i,{prop:"sync",align:"center",label:o(e)("crud.log.sync")},{default:n(l=>[a(R,{type:l.row.sync>0?"primary":"info"},{default:n(()=>[y(s(l.row.sync>0?o(e)("crud.log.sync yes"):o(e)("crud.log.sync no")),1)]),_:2},1032,["type"])]),_:1},8,["label"])]),_:1},512)]),_:1},8,["model-value","title"]),a(V,{modelValue:t.showConfig,"onUpdate:modelValue":r[8]||(r[8]=l=>t.showConfig=l),title:o(e)("crud.log.Settings")},{footer:n(()=>[m("div",qe,[a(c,{onClick:r[7]||(r[7]=l=>D(!1))},{default:n(()=>[y(s(o(e)("Cancel")),1)]),_:1}),g((p(),b(c,{onClick:z,type:"primary"},{default:n(()=>[y(s(o(e)("Save")),1)]),_:1})),[[w]])])]),default:n(()=>[m("div",{class:"ba-operate-form",style:he(o(_).layout.shrink?"":"width: calc(100% - 90px)")},[a(de,{onKeyup:we(z,["enter"]),model:t.configForm,"label-position":"top"},{default:n(()=>[a(F,{label:o(e)("crud.log.CRUD design record synchronization scheme"),modelValue:t.configForm.syncType,"onUpdate:modelValue":r[4]||(r[4]=l=>t.configForm.syncType=l),type:"radio","input-attr":{border:!0,content:{manual:o(e)("crud.log.Manual"),automatic:o(e)("crud.log.automatic")}},"block-help":o(e)("crud.log.You can use the synchronized design records across devices")},null,8,["label","modelValue","input-attr","block-help"]),t.configForm.syncType=="automatic"?(p(),b(F,{key:t.configForm.syncType,label:o(e)("crud.log.When automatically synchronizing records, share them to the open source community"),modelValue:t.configForm.syncAutoPublic,"onUpdate:modelValue":r[5]||(r[5]=l=>t.configForm.syncAutoPublic=l),type:"radio","input-attr":{border:!0,content:{no:o(e)("crud.log.Not to share"),yes:o(e)("crud.log.Share")}},"block-help":o(e)("crud.log.Enabling sharing can automatically earn community points during development")},null,8,["label","modelValue","input-attr","block-help"])):_e("",!0),a(F,{label:o(e)("crud.log.The synchronized CRUD records are automatically resynchronized when they are updated"),modelValue:t.configForm.syncedUpdate,"onUpdate:modelValue":r[6]||(r[6]=l=>t.configForm.syncedUpdate=l),type:"radio","input-attr":{border:!0,content:{no:o(e)("crud.log.Do not resynchronize"),yes:o(e)("crud.log.Automatic resynchronization")}}},null,8,["label","modelValue","input-attr"])]),_:1},8,["model"])],4)]),_:1},8,["modelValue","title"]),a(V,{modelValue:t.showUpload,"onUpdate:modelValue":r[10]||(r[10]=l=>t.showUpload=l),title:o(e)("Upload"),width:"60%"},{footer:n(()=>[m("div",He,[a(c,{onClick:r[9]||(r[9]=l=>S(!1))},{default:n(()=>[y(s(o(e)("Cancel")),1)]),_:1}),g((p(),b(c,{onClick:oe,type:"primary"},{default:n(()=>[y(s(o(e)("Upload")),1)]),_:1})),[[w]])])]),default:n(()=>[g((p(),B("div",Ke,[a(U,{"empty-text":o(e)("crud.log.No effective design"),data:t.uploadValidData,stripe:"",class:"w100"},{default:n(()=>[a(i,{prop:"table_name",label:o(e)("crud.log.table_name"),align:"center"},null,8,["label"]),a(i,{prop:"comment",label:o(e)("crud.log.comment"),align:"center","show-overflow-tooltip":""},null,8,["label"]),a(i,{prop:"fieldCount",label:o(e)("crud.log.Number of fields"),align:"center"},null,8,["label"]),a(i,{label:o(e)("crud.log.Upload type"),align:"center"},{default:n(l=>[a(R,{type:l.row.id>0?"primary":"success"},{default:n(()=>[y(s(l.row.id>0?o(e)("crud.log.Update"):o(e)("crud.log.New added")),1)]),_:2},1032,["type"])]),_:1},8,["label"]),a(i,{prop:"score",label:o(e)("crud.log.Share to earn points"),align:"center"},{default:n(l=>[a(T,{type:l.row.score<=0?"info":"success"},{default:n(()=>[y(s(l.row.score),1)]),_:2},1032,["type"])]),_:1},8,["label"]),a(i,{label:o(e)("crud.log.Share to the open source community"),align:"center"},{default:n(l=>[a(re,{modelValue:l.row.public,"onUpdate:modelValue":C=>l.row.public=C},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"])]),_:1},8,["empty-text","data"])])),[[$,t.uploadValidLoading]])]),_:1},8,["modelValue","title"]),a(V,{modelValue:t.showDownload,"onUpdate:modelValue":r[12]||(r[12]=l=>t.showDownload=l),title:o(e)("crud.log.Cloud record")},{default:n(()=>[m("div",Me,[g((p(),b(c,{onClick:v,color:"#40485b",class:"download-table-header-operate",type:"info"},{default:n(()=>[a(h,{color:"#fff",size:"14",name:"fa fa-refresh"})]),_:1})),[[w]]),a(A,{onConfirm:J,"confirm-button-text":o(e)("Delete"),"cancel-button-text":o(e)("Cancel"),confirmButtonType:"danger",title:o(e)("Are you sure to delete the selected record?"),disabled:!(t.downloadSelection.length>0)},{reference:n(()=>[g((p(),b(c,{disabled:!(t.downloadSelection.length>0),class:"download-table-header-operate",type:"danger"},{default:n(()=>[a(h,{color:"#fff",size:"14",name:"fa fa-trash"}),m("span",Oe,s(o(e)("Delete")),1)]),_:1},8,["disabled"])),[[w]])]),_:1},8,["confirm-button-text","cancel-button-text","title","disabled"]),m("div",je,[a(se,{modelValue:t.downloadQuickSearch,"onUpdate:modelValue":r[11]||(r[11]=l=>t.downloadQuickSearch=l),class:"xs-hidden download-quick-search",onInput:o(ne),placeholder:o(e)("Search"),clearable:""},null,8,["modelValue","onInput","placeholder"])])]),g((p(),b(U,{onSelectionChange:le,"empty-text":o(e)("crud.log.No design record"),data:t.downloadData,stripe:"",class:"w100"},{default:n(()=>[a(i,{type:"selection",align:"center"}),a(i,{"show-overflow-tooltip":!0,align:"center",label:o(e)("crud.log.table_name")},{default:n(l=>[y(s((l.row.table.databaseConnection?l.row.table.databaseConnection+".":"")+l.row.table.name),1)]),_:1},8,["label"]),a(i,{prop:"comment",label:o(e)("crud.log.comment"),align:"center","show-overflow-tooltip":""},null,8,["label"]),a(i,{label:o(e)("crud.log.Field"),align:"center"},{default:n(l=>[a(ce,{width:460,class:"box-item",title:o(e)("crud.log.Field information"),placement:"left"},{reference:n(()=>[a(T,{class:"cp",type:"primary"},{default:n(()=>[y(s(l.row.fieldCount),1)]),_:2},1024)]),default:n(()=>[a(U,{"empty-text":o(e)("crud.log.No field"),data:l.row.fields,stripe:"",class:"w100"},{default:n(()=>[a(i,{prop:"name",label:o(e)("crud.log.Field name"),align:"center"},null,8,["label"]),a(i,{prop:"comment",label:o(e)("crud.log.Note"),align:"center","show-overflow-tooltip":""},null,8,["label"]),a(i,{label:o(e)("crud.log.Type"),align:"center","show-overflow-tooltip":""},{default:n(C=>[a(T,null,{default:n(()=>[y(s(C.row.dataType??C.row.type),1)]),_:2},1024)]),_:1},8,["label"])]),_:2},1032,["empty-text","data"])]),_:2},1032,["title"])]),_:1},8,["label"]),a(i,{label:o(e)("Operate"),align:"center"},{default:n(l=>[a(A,{title:o(e)("crud.crud.Start CRUD design with this record?"),onConfirm:C=>Z(l.row.id)},{reference:n(()=>[a(c,{type:"primary",link:""},{default:n(()=>[m("div",null,s(o(e)("crud.log.Load")),1)]),_:1})]),_:2},1032,["title","onConfirm"]),a(A,{title:o(e)("crud.log.Delete cloud records?"),onConfirm:C=>I([l.row.id])},{reference:n(()=>[a(c,{type:"danger",link:""},{default:n(()=>[m("div",null,s(o(e)("Delete")),1)]),_:1})]),_:2},1032,["title","onConfirm"])]),_:1},8,["label"])]),_:1},8,["empty-text","data"])),[[$,t.downloadLoading]]),m("div",Qe,[a(ie,{currentPage:t.downloadPage,"page-size":10,background:"",layout:o(_).layout.shrink?"prev, next, jumper":"total, ->, prev, pager, next, jumper",total:t.downloadTotal,onCurrentChange:ae},null,8,["currentPage","layout","total"])])]),_:1},8,["modelValue","title"]),a(Ne,{modelValue:t.showBaAccount,"onUpdate:modelValue":r[13]||(r[13]=l=>t.showBaAccount=l),"login-callback":te},null,8,["modelValue"])])}}});export{oo as _};
