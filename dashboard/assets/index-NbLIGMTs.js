import{e as R,a8 as T,a as V,f as k,s as d,h as l,o,k as i,U as p,a5 as w,X as m,W as _,j as D,V as E,_ as x,l as S,a9 as C}from"./vue-DdIC1N8d.js";import{j as r,S as U,A as j,C as F,_ as N,D as I}from"./index-C3V9u2Ed.js";const X=["id"],$={key:0,class:"loading"},z={key:1,class:"captcha-img-box"},M=["src","alt"],Y=["onClick"],A={key:2,class:"captcha-prompt"},P={key:3,class:"captcha-prompt"},W={class:"captcha-refresh-box"},Z=["title"],q=R({__name:"index",props:{uuid:{default:""},callback:{type:Function,default:()=>{}},class:{default:""},unset:{type:Boolean,default:!1},error:{default:r.global.t("validate.The correct area is not clicked, please try again!")},success:{default:r.global.t("validate.Verification is successful!")},apiBaseURL:{default:""}},emits:["destroy"],setup(h,{emit:u}){T(e=>({"09831d2d":d(U),d491669a:L.value,"2e1ecf29":B.value,"2545ff7a":t.captcha.width,"69aaf5f3":t.captcha.height}));const a=h,t=V({loading:!0,xy:[],tip:"",captcha:{id:"",text:"",base64:"",width:350,height:200}}),f=u,g=()=>{t.loading=!0,j(a.uuid,a.apiBaseURL).then(e=>{t.xy=[],t.tip="",t.loading=!1,t.captcha=e.data})},v=e=>{if(t.xy.length<t.captcha.text.length&&(t.xy.push(e.offsetX+","+e.offsetY),t.xy.length==t.captcha.text.length)){const s=[t.xy.join("-"),e.target.width,e.target.height].join(";");F(a.uuid,s,a.unset,a.apiBaseURL).then(()=>{t.tip=a.success,setTimeout(()=>{var c;(c=a.callback)==null||c.call(a,s),y()},1500)}).catch(()=>{t.tip=a.error,setTimeout(()=>{g()},1500)})}},b=e=>{t.xy.splice(e,1)},y=()=>{f("destroy")},B=k(()=>(t.captcha.height+200)/2+"px"),L=k(()=>(t.captcha.width+24)/2+"px");return g(),(e,s)=>(o(),l("div",{id:e.uuid},[i("div",{class:x(["ba-click-captcha",a.class])},[t.loading?(o(),l("div",$,p(d(r).global.t("utils.Loading")),1)):(o(),l("div",z,[i("img",{class:"captcha-img",onClick:s[0]||(s[0]=w(c=>v(c),["prevent"])),src:t.captcha.base64,alt:d(r).global.t("validate.Captcha loading failed, please click refresh button")},null,8,M),(o(!0),l(m,null,_(t.xy,(c,n)=>(o(),l("span",{key:n,class:"step",onClick:H=>b(n),style:D(`left:${parseFloat(c.split(",")[0])-13}px;top:${parseFloat(c.split(",")[1])-13}px`)},p(n+1),13,Y))),128))])),t.tip?(o(),l("div",A,p(t.tip),1)):(o(),l("div",P,[E(p(d(r).global.t("validate.Please click"))+" ",1),(o(!0),l(m,null,_(t.captcha.text,(c,n)=>(o(),l("span",{key:n,class:x(t.xy.length>n?"clicaptcha-clicked":"")},p(c),3))),128))])),i("div",W,[s[1]||(s[1]=i("div",{class:"captcha-refresh-line captcha-refresh-line-l"},null,-1)),i("i",{class:"fa fa-refresh captcha-refresh-btn",title:d(r).global.t("Refresh"),onClick:g},null,8,Z),s[2]||(s[2]=i("div",{class:"captcha-refresh-line captcha-refresh-line-r"},null,-1))])],2),i("div",{class:"ba-layout-shade",onClick:y})],8,X))}}),G=N(q,[["__scopeId","data-v-c3370b98"]]),O=(h,u,a={})=>{const t=document.createElement("div"),f=S(G,{uuid:h,callback:u,...a,key:I(),onDestroy:()=>{C(null,t)}});C(f,t),document.body.appendChild(t.firstElementChild)};export{O as c};
