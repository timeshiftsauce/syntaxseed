import{e as x,aI as N,aJ as P,a7 as S,a as w,A as G,m as d,Y as A,h as b,o as m,l as i,s as a,O as c,Z as y,k as n,U as u,N as B,V as f,a6 as T}from"./vue-DdIC1N8d.js";import{x as q,u as E,y as K,_ as j}from"./index-C3V9u2Ed.js";import{u as J,b as O,c as Y}from"./index-BASh_3MO.js";import{c as Z}from"./index-NbLIGMTs.js";import{F as C}from"./index-1wj2obtz.js";import{b as v}from"./validate-BCdw8ftN.js";const H={key:0,class:"userinfo"},Q={class:"user-avatar-box"},W=["src"],X={class:"username"},ee={class:"user-info"},ae={class:"userinfo-buttons"},oe={href:"https://uni.buildadmin.com/user",target:"_blank",rel:"noopener noreferrer"},te={key:1,class:"ba-login"},se={class:"ba-title"},ne={target:"_blank",class:"ba-account-register",href:"https://uni.buildadmin.com/user/login?type=register",rel:"noopener noreferrer"},le=x({__name:"baAccount",props:N({loginCallback:{type:Function,default:()=>{}}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:["update:modelValue"],setup(h){const{t:l}=q.useI18n(),t=J(),F=E(),g=P(h,"modelValue"),k=S("baAccountFormRef"),L=h,o=w({loading:!0,submitLoading:!1,user:{tab:"login",username:"",password:"",captchaId:K(),captchaInfo:"",keep:!1}}),I=()=>{var s;(s=k.value)==null||s.validate(e=>{e&&Z(o.user.captchaId,_=>U(_),{apiBaseURL:F.apiUrl})})},U=(s="")=>{o.submitLoading=!0,o.user.captchaInfo=s,O(o.user).then(e=>{t.dataFill(e.data.userInfo,!1),L.loginCallback(e)}).finally(()=>{o.submitLoading=!1})},z=w({username:[v({name:"required",title:l("layouts.Username")})],password:[v({name:"required",title:l("layouts.Password")}),v({name:"password"})]});return G(()=>g.value,s=>{s&&t.token&&Y().then(e=>{t.dataFill(e.data.userInfo)}).catch(()=>{t.removeToken()}).finally(()=>{o.loading=!1})}),(s,e)=>{const _=d("Icon"),p=d("el-button"),R=d("el-form-item"),$=d("el-form"),D=d("el-dialog"),V=A("blur"),M=A("loading");return m(),b("div",null,[i(D,{modelValue:g.value,"onUpdate:modelValue":e[5]||(e[5]=r=>g.value=r),class:"ba-account-dialog",width:"25%",title:a(l)("layouts.Member information")},{default:c(()=>[a(t).token?y((m(),b("div",H,[n("div",Q,[n("img",{class:"user-avatar",src:a(t).avatar,alt:""},null,8,W),i(_,{class:"user-avatar-gender",name:a(t).getGenderIcon().name,size:"14",color:a(t).getGenderIcon().color},null,8,["name","color"])]),n("p",X,u(a(t).nickname),1),n("p",ee,[n("span",null,u(s.$t("Integral")+" "+a(t).score),1),n("span",null,u(s.$t("Balance")+" "+a(t).money),1)]),n("div",ae,[n("a",oe,[y((m(),B(p,{size:"default",type:"primary"},{default:c(()=>[f(u(s.$t("layouts.Member center")),1)]),_:1})),[[V]])]),y((m(),B(p,{onClick:e[0]||(e[0]=r=>a(t).logout()),size:"default",type:"warning"},{default:c(()=>[f(u(s.$t("layouts.Logout")),1)]),_:1})),[[V]])])])),[[M,o.loading]]):(m(),b("div",te,[n("h3",se,u(a(l)("layouts.Login to the buildadmin")),1),i($,{onKeyup:e[4]||(e[4]=T(r=>I(),["enter"])),ref_key:"baAccountFormRef",ref:k,rules:z,class:"ba-account-login-form",model:o.user},{default:c(()=>[i(C,{modelValue:o.user.username,"onUpdate:modelValue":e[1]||(e[1]=r=>o.user.username=r),type:"string",prop:"username",placeholder:a(l)("layouts.Please enter buildadmin account name or email"),"input-attr":{size:"large"}},null,8,["modelValue","placeholder"]),i(C,{modelValue:o.user.password,"onUpdate:modelValue":e[2]||(e[2]=r=>o.user.password=r),type:"password",prop:"password",placeholder:a(l)("layouts.Please enter the buildadmin account password"),"input-attr":{size:"large"}},null,8,["modelValue","placeholder"]),i(R,{class:"form-buttons"},{default:c(()=>[i(p,{onClick:e[3]||(e[3]=r=>I()),loading:o.submitLoading,round:"",type:"primary",size:"large"},{default:c(()=>[f(u(a(l)("layouts.Login")),1)]),_:1},8,["loading"]),n("a",ne,[i(p,{round:"",plain:"",type:"info",size:"large"},{default:c(()=>[f(u(a(l)("layouts.Register")),1)]),_:1})])]),_:1})]),_:1},8,["rules","model"])]))]),_:1},8,["modelValue","title"])])}}}),pe=j(le,[["__scopeId","data-v-3d2b2a16"]]);export{pe as B};
